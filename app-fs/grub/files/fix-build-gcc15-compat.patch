--- a/Makefile.in
+++ b/Makefile.in
@@ -16104,7 +16104,8 @@
 # For libgrub.a
 libgrub.pp: config-util.h grub_script.tab.h grub_script.yy.h $(libgrubmods_a_SOURCES) $(libgrubkern_a_SOURCES)
 	$(CPP) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libgrubmods_a_CPPFLAGS) $(libgrubkern_a_CPPFLAGS) $(CPPFLAGS) \
-	  -D'GRUB_MOD_INIT(x)=@MARKER@x@' $^ > $@ || (rm -f $@; exit 1)
+	  -include config-util.h -D'GRUB_MOD_INIT(x)=@MARKER@x@' \
+	  $(filter-out config-util.h,$^) > $@ || (rm -f $@; exit 1)
 
 libgrub_a_init.lst: libgrub.pp
 	cat $< | grep '^@MARKER@' | sed 's/@MARKER@\(.*\)@/\1/g' | sort -u > $@ || (rm -f $@; exit 1)
@@ -16115,7 +16116,8 @@
 # For grub-fstest
 grub_fstest.pp: config-util.h $(grub_fstest_SOURCES)
 	$(CPP) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(grub_fstest_CPPFLAGS) $(CPPFLAGS) \
-	  -D'GRUB_MOD_INIT(x)=@MARKER@x@' $^ > $@ || (rm -f $@; exit 1)
+	  -include config-util.h -D'GRUB_MOD_INIT(x)=@MARKER@x@' \
+	  $(filter-out config-util.h,$^) > $@ || (rm -f $@; exit 1)
 
 grub_fstest_init.lst: libgrub.pp grub_fstest.pp
 	cat $^ | grep '^@MARKER@' | sed 's/@MARKER@\(.*\)@/\1/g' | sort -u > $@ || (rm -f $@; exit 1)
--- a/grub-core/Makefile.in
+++ b/grub-core/Makefile.in
@@ -57784,7 +57784,7 @@
 @COND_ENABLE_EFIEMU_TRUE@efiemu64.o: efiemu64_c.o efiemu64_s.o $(TARGET_OBJ2ELEF)
 @COND_ENABLE_EFIEMU_TRUE@	-rm -f $@
 @COND_ENABLE_EFIEMU_TRUE@	-rm -f $@.bin
-@COND_ENABLE_EFIEMU_TRUE@	$(TARGET_CC) -m64 $(EFIEMU64_LINK_FORMAT) -nostdlib -static -Wl,-r -o $@.bin $^
+@COND_ENABLE_EFIEMU_TRUE@	$(TARGET_CC) -m64 $(EFIEMU64_LINK_FORMAT) -nostdlib -static -no-pie -Wl,-r -o $@.bin $^
 @COND_ENABLE_EFIEMU_TRUE@	if test "x$(EFIEMU64_LINK_FORMAT)" = x-arch,x86_64; then \
 @COND_ENABLE_EFIEMU_TRUE@	  $(TARGET_OBJCONV) -felf64 -nu -nd $@.bin $@ || exit 1; \
 @COND_ENABLE_EFIEMU_TRUE@	  rm -f $@.bin; \
--- a/config-util.h.in
+++ b/config-util.h.in
@@ -2662,7 +2662,7 @@
    -Wthread-safety is enabled.  For usage, see
    <https://clang.llvm.org/docs/ThreadSafetyAnalysis.html>.  */
 #ifndef _GL_ATTRIBUTE_CAPABILITY_TYPE
-# if __clang_major__ >= 15
+# if defined __clang_major__ && __clang_major__ >= 15
 #  define _GL_ATTRIBUTE_CAPABILITY_TYPE(concept) \
      __attribute__ ((__capability__ (concept)))
 # else
@@ -2670,7 +2670,7 @@
 # endif
 #endif
 #ifndef _GL_ATTRIBUTE_ACQUIRE_CAPABILITY
-# if __clang_major__ >= 15
+# if defined __clang_major__ && __clang_major__ >= 15
 #  define _GL_ATTRIBUTE_ACQUIRE_CAPABILITY(resource) \
      __attribute__ ((__acquire_capability__ (resource)))
 # else
@@ -2678,7 +2678,7 @@
 # endif
 #endif
 #ifndef _GL_ATTRIBUTE_RELEASE_CAPABILITY
-# if __clang_major__ >= 15
+# if defined __clang_major__ && __clang_major__ >= 15
 #  define _GL_ATTRIBUTE_RELEASE_CAPABILITY(resource) \
      __attribute__ ((__release_capability__ (resource)))
 # else
@@ -2990,7 +2990,8 @@
      && !defined assert \
      && (!defined __cplusplus \
          || (__cpp_static_assert < 201411 \
-             && __GNUG__ < 6 && __clang_major__ < 6))))
+             && __GNUG__ < 6 && __clang_major__ < 6))) \
+     && (!defined __STDC_HOSTED__ || __STDC_HOSTED__ + 0))
  #include <assert.h>
  #undef/**/assert
  /* Solaris 11.4 <assert.h> defines static_assert as a macro with 2 arguments.
